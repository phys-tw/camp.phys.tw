<!DOCTYPE html>

<html lang="zh-tw">
<head>
	<title>Tower</title>
	<link rel="stylesheet" type="text/css" href="tower.css" media="only screen and (max-width: 600px)" />
	<link rel="stylesheet" type="text/css" href="desptop.css" media="screen and (min-width: 601px)" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="user-scalable=no, width=device-width" />
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="expires" content="0">
	<script type="text/javascript">
		function getData()
		{
			if (!!window.EventSource) {
				var source = new EventSource('update.php');
			}
			else
			{
				alert('Oops! no SSE!!!');
			}
			source.addEventListener('message', function(e) {
				var data=e.data.split(";");
				//alert(123);
				var data_n=parseInt(data[0]);
				info(data_n,data);
			}, false);
		}
		function info(data_n,data)
		{
			var i;
			var element;
			for(i=7;i>=1;i--)
			{
				element='tower'+i;
				stat=data_n%10;
				data_n=Math.floor(data_n/10);
				owner=data_n%10;
				data_n=Math.floor(data_n/10);
				if(document.getElementById(element+'_owner').innerHTML=='Team A'&&(owner))
				{
					//alert(document.getElementById(element+'_owner').innerHTML+!owner+i);
					document.getElementById('loading2').style.visibility='visible';
					document.getElementById('load2_text').innerHTML='塔 '+i+' 換主人啦！';
				}
				else if(document.getElementById(element+'_owner').innerHTML=="Team B"&&(!owner))
				{
					document.getElementById('loading2').style.visibility='visible';
					document.getElementById('load2_text').innerHTML='塔 '+i+' 換主人啦！';
				}
				if(stat&&document.getElementById(element+'_status').innerHTML=='Safe')
				{
					document.getElementById('loading').style.visibility='visible';
					document.getElementById('load_text').innerHTML='塔 '+i+' 被打啦！';
				}
				if(!owner) 
				{
					document.getElementById(element+'_owner').innerHTML='Team A';
					document.getElementById(element+'_owner').style.color='blue';
				}
				else
				{
					document.getElementById(element+'_owner').innerHTML='Team B';
					document.getElementById(element+'_owner').style.color='red';
				}
				if(!stat) 
				{
					document.getElementById(element+'_status').innerHTML='Safe';
					document.getElementById(element+'_status').style.color='green';
					document.getElementById('t'+i).style.visibility='hidden';
					document.getElementById('i'+i).style.background='#fefefe';
				}
				else
				{
					document.getElementById(element+'_status').innerHTML='Under Attack!!!';
					document.getElementById(element+'_status').style.color='red';
					document.getElementById('t'+i).innerHTML=parseInt(data[i]);
					if(parseInt(data[i])>=60)
						document.getElementById('i'+i).style.background='#FC9AA1';
					else if(parseInt(data[i])>=30)
						document.getElementById('i'+i).style.background='#FF636E';
					else if(parseInt(data[i])>=10)
						document.getElementById('i'+i).style.background='#FC424E';
					else if(parseInt(data[i])==0)
						document.getElementById('i'+i).style.background='#FC3240';
					document.getElementById('t'+i).style.visibility='visible';
				}
			}
		}
		function record(){
			var i;
			var cnt=0;
			for(i=1;i<=7;i++)
			{
				if(document.getElementById('tower'+i+'_owner').innerHTML=='Team A') cnt++;
			}
			alert('Team A: '+cnt+' towers\nTeam B: '+(7-cnt)+' towers');
		}
	</script>
</head>
<body onload="getData()">
	<div id="head">
		<h1>守塔資訊系統</h1>
	</div>
	<div id="loading" class="load">
		<a id="close" class="closing" onclick="document.getElementById('loading').style.visibility='hidden';">x</a>
		<span id="load_text"></span>
	</div>
	<div id="loading2" class="load">
		<a id="close2" class="closing" onclick="document.getElementById('loading2').style.visibility='hidden';">x</a>
		<span id="load2_text"></span>
	</div>
	<div id="content">
		<div id="main_menu" class="menu">
			<ul>
				<!--<li><a onclick="battle()">交戰！</a></li>-->
				<li><a href="#tower_menu">詳細訊息</a></li>
				<li><a href="#" onclick="record()">兩方戰績</a></li>
				<!--<li><a>訊息交流</a></li>-->
			</ul>
		</div>
	</div>
	<hr />
	<div id="tower_display">
		<div id="tower_menu" class="menu" name="tower_menu">
			<ul>
				<li id="i1">
					<a name="tower1">
					<div class="tower_info">
						<h2 class="tower_info_h">Tower I</h2><span class="timer" id="t1"></span>
						<div class="tower_item">Owner: <span id="tower1_owner"></span></div>
						<div class="tower_item">Status: <span id="tower1_status"></span></div>
					</div>
					</a>
				</li>
				<li id="i2">
					<a name="tower2">
					<div class="tower_info">
						<h2 class="tower_info_h">Tower II</h2><span class="timer" id="t2"></span>
						<div class="tower_item">Owner: <span id="tower2_owner"></span></div>
						<div class="tower_item">Status: <span id="tower2_status"></span></div>
					</div>
					</a>
				</li>
				<li id="i3">
					<a name="tower3">
					<div class="tower_info">
						<h2 class="tower_info_h">Tower III</h2><span class="timer" id="t3"></span>
						<div class="tower_item">Owner: <span id="tower3_owner"></span></div>
						<div class="tower_item">Status: <span id="tower3_status"></span></div>
					</div>
					</a>
				</li>
				<li id="i4">
					<a name="tower4">
					<div class="tower_info">
						<h2 class="tower_info_h">Tower IV</h2><span class="timer" id="t4"></span>
						<div class="tower_item">Owner: <span id="tower4_owner"></span></div>
						<div class="tower_item">Status: <span id="tower4_status"></span></div>
					</div>
					</a>
				</li>
				<li id="i5">
					<a name="tower5">
					<div class="tower_info">
						<h2 class="tower_info_h">Tower V</h2><span class="timer" id="t5"></span>
						<div class="tower_item">Owner: <span id="tower5_owner"></span></div>
						<div class="tower_item">Status: <span id="tower5_status"></span></div>
					</div>
					</a>
				</li>
				<li id="i6">
					<a name="tower6">
					<div class="tower_info">
						<h2 class="tower_info_h">Tower VI</h2><span class="timer" id="t6"></span>
						<div class="tower_item">Owner: <span id="tower6_owner"></span></div>
						<div class="tower_item">Status: <span id="tower6_status"></span></div>
					</div>
					</a>
				</li>
				<li id="i7">
					<a name="tower7">
					<div class="tower_info">
						<h2 class="tower_info_h">Tower VII</h2><span class="timer" id="t7"></span>
						<div class="tower_item">Owner: <span id="tower7_owner"></span></div>
						<div class="tower_item">Status: <span id="tower7_status"></span></div>
					</div>
					</a>
				</li>
			</ul>
		</div>
	</div>
</body>

</html>